/*! LETRAS by @Quantium Letras-by-Quantium 27-07-2015 */
function buildStage(a){console.log("buildStage"),letters=[];var b=0;for(var c in a){var d=new Konva.Image({image:a[c],x:b,y:b,draggable:!0,id:c});d.cache(),d.drawHitFromCache(),d.on("dragstart",letterDragStart),d.on("dragend",letterDragEnd),layer.add(d),letters.push(d),b+=10}stage.add(layer)}function loadImages(a,b){console.log("loadedImages");var c={},d=0,e=0;for(var f in a)e++;var g=function(){++d>=e&&b(c)};for(var h in a)c[h]=new Image,c[h].onload=g,c[h].src=a[h]}function getLetter(a){for(i=0;i<letters.length;i++)if(letters[i].id()==a)return letters[i]}function writeMessage(a){simpleText.setText(a),layer.draw()}function letterDragStart(a){writeMessage("dragstart");var b=a.target;console.log("lDS :: ",b.id()),socket.emit("dragstart",{letter:b.id()})}function letterDragEnd(a){writeMessage("dragend");var b=a.target;socket.emit("dragend",{letter:b.id(),x:b.x(),y:b.y()})}var chatlinelimit=5,socket=io(),username="";socket.on("login",function(a){console.log("login"),console.info(a),$("#login").hide("fast"),$("#user_interface").show("fast"),username=a.username,$("#welcome span#username").html(a.username),$("#usercount").html(a.usercount)}),socket.on("msg",function(a){console.log("Socket.On::msg"),console.info(a),$("#chat").append('<div class="chat_message"><span class="username" id="'+a.user+'">'+a.user+"</span>"+a.msg+"</div>");var b=$("#chat .chat_message").length;b>=chatlinelimit&&$("#chat .chat_message:lt(1)").remove()}),socket.on("enter",function(a){console.log("Socket.On::enter"),console.info(a),$("#chat").append('<div class="notification">'+a.username+" enter the room</div>"),$("#usercount").html(a.usercount)}),$(document).ready(function(){$("#user_interface").hide(),$("#loginbtn").click(function(a){var b=$("input#username").val(),c=$("input#email").val();socket.emit("login",{username:b,email:c}),a.preventDefault()}),$("#sendbtn").click(function(a){a.preventDefault();var b=$("#message").val();socket.emit("msg",{msg:b}),$("#message").val("");var c=$("#chat .chat_message").length;c>=chatlinelimit&&$("#chat .chat_message:lt(1)").remove()})});var stage=new Konva.Stage({container:"game",width:578,height:600}),layer=new Konva.Layer,rectX=stage.getWidth()/2-50,rectY=stage.getHeight()/2-25,letters,simpleText=new Konva.Text({name:"A",x:0,y:0,text:"",fontSize:12,fontFamily:"Calibri",fill:"black"});layer.add(simpleText),stage.add(layer);var sources={A:"assets/letters/A.png",B:"assets/letters/B.png",C:"assets/letters/C.png",D:"assets/letters/D.png",E:"assets/letters/E.png",F:"assets/letters/F.png",G:"assets/letters/G.png",H:"assets/letters/H.png",I:"assets/letters/I.png",J:"assets/letters/J.png",K:"assets/letters/K.png",L:"assets/letters/L.png",M:"assets/letters/M.png",N:"assets/letters/N.png",O:"assets/letters/O.png",P:"assets/letters/P.png",Q:"assets/letters/Q.png",R:"assets/letters/R.png",S:"assets/letters/S.png",T:"assets/letters/T.png",U:"assets/letters/U.png",V:"assets/letters/V.png",W:"assets/letters/W.png",X:"assets/letters/X.png",Y:"assets/letters/Y.png",Z:"assets/letters/Z.png"};loadImages(sources,buildStage),socket.on("dragstart",function(a){writeMessage("Hay que DESAPARECER "+a.letter);var b=getLetter(a.letter);b.hide(),layer.draw()}),socket.on("dragend",function(a){writeMessage("Hay que APARECER "+a.letter+" en ("+a.x+","+a.y+")");var b=getLetter(a.letter);b.x(a.x),b.y(a.y),b.show(),layer.draw()});