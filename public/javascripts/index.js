/*! LETRAS by @Quantium Letras-by-Quantium 19-07-2015 */
function getLetter(a){for(i=0;i<letters.length;i++)if(letters[i]._id==a)return letters[i]}function writeMessage(a){simpleText.setText(a),layer.draw()}function letterDragStart(a){writeMessage("dragstart");var b=a.targetNode;console.log(b._id),socket.emit("dragstart",{letter:b._id,user:username})}function letterDragEnd(a){writeMessage("dragend");var b=a.targetNode;console.log(b.attrs.x),socket.emit("dragend",{letter:b._id,user:username,x:b.attrs.x,y:b.attrs.y})}var chatlinelimit=5,socket=io(),username="";socket.on("login",function(a){console.log("login"),console.info(a),$("#login").hide("fast"),$("#user_interface").show("fast"),username=a.username,$("#welcome span#username").html(a.username),$("#usercount").html(a.usercount)}),socket.on("msg",function(a){console.log("Socket.On::msg"),console.info(a),$("#chat").append('<div class="chat_message"><span class="username" id="'+a.user+'">'+a.user+"</span>"+a.msg+"</div>");var b=$("#chat .chat_message").length;b>=chatlinelimit&&$("#chat .chat_message:lt(1)").remove()}),socket.on("enter",function(a){console.log("Socket.On::enter"),console.info(a),$("#chat").append('<div class="notification">'+a.username+" enter the room</div>"),$("#usercount").html(a.usercount)}),$(document).ready(function(){$("#user_interface").hide(),$("#loginbtn").click(function(a){var b=$("input#username").val(),c=$("input#email").val();socket.emit("login",{username:b,email:c}),a.preventDefault()}),$("#sendbtn").click(function(a){a.preventDefault();var b=$("#message").val();socket.emit("msg",{msg:b}),$("#message").val("");var c=$("#chat .chat_message").length;c>=chatlinelimit&&$("#chat .chat_message:lt(1)").remove()})});var stage=new Kinetic.Stage({container:"game",width:578,height:200}),layer=new Kinetic.Layer,rectX=stage.getWidth()/2-50,rectY=stage.getHeight()/2-25,simpleText=new Kinetic.Text({name:"A",x:0,y:0,text:"",fontSize:12,fontFamily:"Calibri",fill:"black"}),l_A=new Kinetic.Text({x:stage.getWidth()/2,y:15,text:"A",fontSize:30,fontFamily:"Calibri",fill:"green",shadowColor:"black",shadowBlur:2,shadowOffset:10,shadowOpacity:0,draggable:!0}),l_B=new Kinetic.Text({x:stage.getWidth()/2,y:25,text:"B",fontSize:30,fontFamily:"Calibri",fill:"green",shadowColor:"black",shadowBlur:2,shadowOffset:10,shadowOpacity:0,draggable:!0}),letters=[l_A,l_B];l_A.on("dragstart",letterDragStart),l_B.on("dragstart",letterDragStart),l_A.on("dragend",letterDragEnd),l_B.on("dragend",letterDragEnd),layer.add(l_A),layer.add(l_B),layer.add(simpleText),stage.add(layer),socket.on("dragstart",function(a){writeMessage("Hay que DESAPARECER "+a.letter);var b=getLetter(a.letter);b.hide(),layer.draw()}),socket.on("dragend",function(a){writeMessage("Hay que APARECER "+a.letter+" en ("+a.x+","+a.y+")");var b=getLetter(a.letter),c=new Kinetic.Animation(function(c){b.setX(a.x),b.setY(a.y)},layer);c.start(),b.show(),layer.draw()});